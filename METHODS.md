# Methods
### Raw data collection
The following species are chosen for the promoter analysis: *Homo sapiens* (29598 promoters), *Drosophila melanogaster* (16972 promoters), *Caenorhabditis elegans* (7120 promoters), *Plasmodium 
falciparum* (5597 promoters), *Arabidopsis thaliana* (22703 promoters), and *Saccharomyces cerevisiae* (5117 promoters).

The promoter sequences are downloaded from the [Eukaryotic Promoter 
Database (EPD)](https://epd.expasy.org/epd/). The selection was restricted 
to the EPDnew IDs. The sequence of each promoter includes -2000 base pairs 
upstream and 2000 base pairs downstream of a reported TSS. 

### Controls
Controls for statistical analysis are generated by shuffling all DNA sequences available.

### Promoter shape prediciton
The shape of the promoters from the six species was analyzed to investigate conservation. Promoter shape prediction was focused on the 400 bp region surrounding the TSS. The  [deepDNAshape package](https://github.com/JinsenLi/deepDNAshape/blob/main/README.md) was used to predict DNA shape properties for each promoter with the following script:

``` bash
species=( athaliana celegans dmelanogaster hsapiens pfalciparum scervisiae )
properties=( MGW Shear Stretch Stagger Buckle ProT Opening Shift Slide Rise Tilt Roll HelT )

input_dir="/local/home/quee4387/raw_promoter_sequences/"
output_dir="/local/home/quee4387/dna_shape/"
for spec in "${species[@]}"
do
    for prop in "${properties[@]}"
    do
        echo "Predicting $prop for $spec"
        python /local/home/quee4387/.conda/envs/myenv/bin/deepDNAshape \
        --file ${input_dir}${spec}_2000.fa \
        --feature $prop \
        --output ${output_dir}${spec}_${prop}_2000.txt
    done
done
```
In this analysis, the following DNA shape features were predicted:
- MGW (minor groove width)
- Shear
- Stretch
- Stagger
- Buckle
- ProT (propeller twist)
- Opening
- Shift
- Slide
- Rise
- Tilt
- Roll
- HelT (hellical twist)

This script generates 78 output `.txt` files, one for each combination of species and DNA shape property.

### Plotting shape conservation within species
To visualize shape conservation, the .txt files were randomly sampled, resulting in matrices of size 1000 Ã— 400, where 1000 represents the number of promoters and 400 represents the length of each promoter sequence. These matrices were used to plot the predicted shape features for each species and property, providing insights into promoter shape conservation across the selected species.
The following command was used: 

``` bash 
shuf -n 1000 <athaliana_MGW_200.txt> > <athaliana_MGW_200_sample_1k.txt>
```
The following R script is used to plot the figures:

``` R
library(ggplot2)
library(reshape2)
library(gridExtra)

properties <- c("MGW", "Buckle","Opening", "Tilt")


input_dir <- "~/Downloads/athaliana_"
plot_list <- list()

for (prop in properties) {

  file_path <- paste0(input_dir, prop, "_200.txt")
  data <- read.table(file_path, header = FALSE)
  average_data <- colMeans(data)
  positions <- seq(-200, 200, length.out = ncol(data))
  average_df <- data.frame(Position = positions, Mean_Value = average_data)

  p <- ggplot(average_df, aes(x = Position, y = Mean_Value)) +
    geom_line(color = "blue") +
    theme_minimal() +
    labs(x = "Position", y = "Average Feature Value", 
         title = paste("Average DNA Shape Prediction for", prop)) +
    scale_x_continuous(breaks = seq(-200, 200, 50))  # Adjust x-axis ticks

  plot_list[[prop]] <- p
}

grid.arrange(grobs = plot_list, ncol = 1)
```
The following figures are obtained:
![image](https://github.com/user-attachments/assets/fe443fd8-0c46-4694-87a5-aa164227bcb3)

